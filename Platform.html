<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منصة موروكس التعليمية</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

  <!-- تسجيل الطالب -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-6 bg-gradient-to-r from-blue-600 to-purple-600">
    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-md">
      <h2 class="text-xl font-bold mb-4">دخول الطالب</h2>
      <form id="studentLoginForm" class="space-y-3">
        <input id="studentName" type="text" placeholder="الاسم الكامل" required class="w-full border p-2 rounded">
        <input id="studentEmail" type="email" placeholder="البريد الإلكتروني" required class="w-full border p-2 rounded">
        <input id="studentPhone" type="tel" placeholder="رقم الهاتف" required class="w-full border p-2 rounded">
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">دخول</button>
      </form>
      <button onclick="showAdminLogin()" class="w-full mt-3 bg-red-500 text-white py-2 rounded">دخول المدير</button>
    </div>
  </div>

  <!-- دخول المدير -->
  <div id="adminLogin" class="hidden min-h-screen flex items-center justify-center p-6 bg-gray-800">
    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-md">
      <h2 class="text-xl font-bold mb-4">دخول المدير</h2>
      <form id="adminLoginForm" class="space-y-3">
        <input id="adminUser" type="text" placeholder="اسم المستخدم" required class="w-full border p-2 rounded">
        <input id="adminPass" type="password" placeholder="كلمة المرور" required class="w-full border p-2 rounded">
        <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded">دخول</button>
      </form>
    </div>
  </div>

  <!-- لوحة المدير -->
  <div id="adminPanel" class="hidden p-6 space-y-6">
    <!-- إدارة الدورات -->
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">إضافة دورة جديدة</h3>
      <input id="courseTitle" type="text" placeholder="عنوان الدورة" class="w-full border p-2 rounded mb-2">
      <input id="courseDescription" type="text" placeholder="الوصف" class="w-full border p-2 rounded mb-2">
      <button onclick="addCourse()" class="w-full bg-green-600 text-white py-2 rounded">إضافة</button>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">الدورات</h3>
      <div id="coursesListAdmin"></div>
    </div>

    <!-- إدارة الإعلانات -->
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">الإعلانات</h3>
      <input id="announcementTitle" type="text" placeholder="عنوان الإعلان" class="w-full border p-2 rounded mb-2">
      <textarea id="announcementContent" placeholder="المحتوى" class="w-full border p-2 rounded mb-2"></textarea>
      <button onclick="addAnnouncement()" class="w-full bg-yellow-600 text-white py-2 rounded">إضافة إعلان</button>
      <div id="announcementsList" class="mt-3"></div>
    </div>

    <!-- إدارة الطلاب -->
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">الطلاب</h3>
      <div id="usersList"></div>
    </div>

    <!-- الإعدادات -->
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">الإعدادات</h3>
      <input id="platformName" type="text" placeholder="اسم المنصة" class="w-full border p-2 rounded mb-2">
      <input id="platformDescription" type="text" placeholder="وصف المنصة" class="w-full border p-2 rounded mb-2">
      <button onclick="saveSettings()" class="w-full bg-blue-600 text-white py-2 rounded">حفظ الإعدادات</button>
    </div>
  </div>

  <!-- واجهة الطالب -->
  <div id="studentPanel" class="hidden p-6 space-y-6">
    <div id="announcementsBanner" class="bg-yellow-300 p-2 rounded hidden"></div>
    <h2 class="text-xl font-bold mb-4">الدورات المتاحة</h2>
    <div id="coursesList"></div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // Config
    const firebaseConfig = {
      apiKey: "AIzaSyBT4YJcnZZmUhKVvs7iMp5mdAeWRjixEfI",
      authDomain: "platform-fd979.firebaseapp.com",
      projectId: "platform-fd979",
      storageBucket: "platform-fd979.firebasestorage.app",
      messagingSenderId: "184754007748",
      appId: "1:184754007748:web:a849462d9cb2bdb3a6e391",
      measurementId: "G-9FB64YHKM3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUser = null;

    // تسجيل الطالب
    studentLoginForm.addEventListener("submit", async e => {
      e.preventDefault();
      currentUser = {
        name: studentName.value,
        email: studentEmail.value,
        phone: studentPhone.value
      };
      await setDoc(doc(db, "users", currentUser.email), currentUser);
      loginScreen.classList.add("hidden");
      studentPanel.classList.remove("hidden");
      loadCourses();
      loadAnnouncements();
    });

    // دخول المدير
    adminLoginForm.addEventListener("submit", e => {
      e.preventDefault();
      if (adminUser.value === "Bashar" && adminPass.value === "bbsshhaarr6405") {
        adminLogin.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        loadCoursesAdmin();
        loadAnnouncementsAdmin();
        loadUsers();
      } else alert("بيانات المدير خاطئة");
    });
    window.showAdminLogin = () => { loginScreen.classList.add("hidden"); adminLogin.classList.remove("hidden"); };

    // الدورات
    window.addCourse = async () => {
      if (!courseTitle.value) return;
      await addDoc(collection(db, "courses"), { title: courseTitle.value, description: courseDescription.value });
      loadCourses(); loadCoursesAdmin();
    };
    async function loadCourses() {
      const snap = await getDocs(collection(db, "courses"));
      coursesList.innerHTML = "";
      snap.forEach(d => { let c=d.data(); coursesList.innerHTML += `<div class="bg-white p-3 rounded shadow mb-2"><h4>${c.title}</h4><p>${c.description}</p></div>`; });
    }
    async function loadCoursesAdmin() {
      const snap = await getDocs(collection(db, "courses"));
      coursesListAdmin.innerHTML = "";
      snap.forEach(d => { let c=d.data(); coursesListAdmin.innerHTML += `<p>${c.title} - ${c.description}</p>`; });
    }

    // الإعلانات
    window.addAnnouncement = async () => {
      if (!announcementTitle.value) return;
      await addDoc(collection(db, "announcements"), { title: announcementTitle.value, content: announcementContent.value });
      loadAnnouncements(); loadAnnouncementsAdmin();
    };
    async function loadAnnouncements() {
      const snap = await getDocs(collection(db, "announcements"));
      if (!snap.empty) {
        announcementsBanner.classList.remove("hidden");
        let first = snap.docs[0].data();
        announcementsBanner.innerHTML = `<strong>${first.title}:</strong> ${first.content}`;
      }
    }
    async function loadAnnouncementsAdmin() {
      const snap = await getDocs(collection(db, "announcements"));
      announcementsList.innerHTML = "";
      snap.forEach(d => { let a=d.data(); announcementsList.innerHTML += `<p>${a.title}: ${a.content}</p>`; });
    }

    // المستخدمين
    async function loadUsers() {
      const snap = await getDocs(collection(db, "users"));
      usersList.innerHTML = "";
      snap.forEach(d => { let u=d.data(); usersList.innerHTML += `<p>${u.name} - ${u.email}</p>`; });
    }

    // الإعدادات
    window.saveSettings = async () => {
      await setDoc(doc(db, "settings", "platform"), {
        name: platformName.value,
        description: platformDescription.value
      });
      alert("تم حفظ الإعدادات");
    };
  </script>
</body>
</html>
