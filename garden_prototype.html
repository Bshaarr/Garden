<!doctype html>

<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>حديقة الألوان المفقودة — Prototype</title>
  <style>
    /* بسيط وأنيق — لوحة اللعب على كامل الشاشة */
    :root{--ui-bg:#111;--panel:#0f0f12;--accent:#8be9fd}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial;direction:rtl}
    #app{display:grid;grid-template-columns:1fr 320px;gap:12px;height:100vh;padding:12px;background:linear-gradient(180deg,#0b1220,#0b0b0b)}
    canvas{background:#fff;display:block;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
    .panel{background:var(--panel);color:#ddd;border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:12px}
    h1{margin:0;font-size:18px;color:var(--accent)}
    .palette{display:flex;gap:8px;flex-wrap:wrap}
    .swatch{width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px solid rgba(255,255,255,.06)}
    .btn{background:transparent;border:1px solid rgba(255,255,255,.06);padding:8px;border-radius:8px;cursor:pointer;color:#ddd}
    .small{font-size:13px;color:#bbb}
    .inventory{display:flex;gap:8px;flex-wrap:wrap}
    .seed{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,.4)}
    .log{height:120px;overflow:auto;background:rgba(255,255,255,.02);padding:8px;border-radius:8px;font-size:13px}
    footer{font-size:12px;color:#999}
  </style>
</head>
<body>
  <div id="app">
    <canvas id="world" width="1200" height="800"></canvas><div class="panel">
  <div>
    <h1>حديقة الألوان المفقودة</h1>
    <div class="small">أنت الحارس — اجمع بذور الألوان، اخلطها، وأعد الحياة للحديقة.</div>
  </div>

  <div>
    <div class="small">لوحة المزج (اختر لوناً أساسيًا ثم اسحب للخلط)</div>
    <div id="palette" class="palette"></div>
    <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
      <button id="mixBtn" class="btn">امزج</button>
      <div id="currentColor" style="width:44px;height:44px;border-radius:8px;border:1px solid rgba(255,255,255,.06)"></div>
      <div style="flex:1;text-align:left" class="small">اللون الحالي</div>
    </div>
  </div>

  <div>
    <div class="small">حقيبتي (بذور الألوان التي جمعتها)</div>
    <div id="inventory" class="inventory"></div>
  </div>

  <div>
    <div class="small">الإجراءات</div>
    <div style="display:flex;gap:8px">
      <button id="paintBtn" class="btn">استخدم اللون للتلوين</button>
      <button id="inspectBtn" class="btn">تفقد</button>
      <button id="hintBtn" class="btn">تلميح</button>
    </div>
  </div>

  <div>
    <div class="small">سجّل الأحداث</div>
    <div id="log" class="log"></div>
  </div>

  <div style="margin-top:auto">
    <div class="small">المناطق المفتوحة: <span id="areasCount">1</span></div>
    <footer>نموذج أولي بسيط — اطلب مني إضافة ميزات (ألغاز متقدمة، حفظ، أصوات...)</footer>
  </div>
</div>

  </div>  <script>
  // === إعداد البيئة واللوحة ===
  const canvas = document.getElementById('world');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // عناصر DOM
  const paletteEl = document.getElementById('palette');
  const inventoryEl = document.getElementById('inventory');
  const currentColorEl = document.getElementById('currentColor');
  const mixBtn = document.getElementById('mixBtn');
  const paintBtn = document.getElementById('paintBtn');
  const inspectBtn = document.getElementById('inspectBtn');
  const hintBtn = document.getElementById('hintBtn');
  const logEl = document.getElementById('log');
  const areasCountEl = document.getElementById('areasCount');

  // حالة اللعبة الأساسية
  const game = {
    seeds: [], // بذور على الخريطة
    inventory: [], // بذور مجمعة {colorName, rgb}
    currentMix: [], // قائمة الألوان المختارة للخلط
    activeColor: null,
    paintedAreas: 0,
    areasUnlocked: 1,
    creatures: [],
    player: {x: W/2, y: H/2},
    objects: []
  };

  // الألوان الأساسية المعرفة
  const COLORS = {
    'أحمر': [220,30,30],
    'أصفر': [240,210,30],
    'أزرق': [40,120,220]
  };

  // مزيج الألوان — دالة بسيطة: متوسط RGB
  function mixRGB(list){
    if(!list.length) return [200,200,200];
    const sum=[0,0,0];
    list.forEach(rgb=>{sum[0]+=rgb[0];sum[1]+=rgb[1];sum[2]+=rgb[2]});
    return sum.map(v=>Math.round(v/list.length));
  }

  // مساعدة لكتابة في السجل
  function log(text){
    const row = document.createElement('div');row.textContent = text;logEl.prepend(row);
  }

  // إنشاء لوحة مزج (الألوان الأساسية + ألوان مخلوطة من الحقيبة)
  function renderPalette(){
    paletteEl.innerHTML='';
    // أضف الألوان الأساسية
    Object.entries(COLORS).forEach(([name,rgb])=>{
      const sw = document.createElement('div');sw.className='swatch';sw.title=name;sw.style.background=`rgb(${rgb.join(',')})`;
      sw.onclick = ()=>{ if(game.currentMix.length<3){game.currentMix.push({name,rgb});sw.style.outline='3px solid rgba(255,255,255,.14)';log('أضفت '+name+' إلى المزج'); } else{ log('يمكنك مزج حتى 3 ألوان فقط'); } }
      paletteEl.appendChild(sw);
    });
    // أضف ألوان من الحقيبة كمصادر مزج إضافية
    game.inventory.forEach((s,i)=>{
      const sw = document.createElement('div');sw.className='swatch';sw.title=s.colorName;sw.style.background=`rgb(${s.rgb.join(',')})`;
      sw.onclick = ()=>{ if(game.currentMix.length<3){game.currentMix.push({name:s.colorName,rgb:s.rgb});sw.style.transform='scale(0.96)';log('أضفت '+s.colorName+' (من الحقيبة) إلى المزج'); } else log('يمكنك مزج حتى 3 ألوان فقط'); }
      paletteEl.appendChild(sw);
    });
  }

  // تحديث الحقيبة المرئية
  function renderInventory(){
    inventoryEl.innerHTML='';
    game.inventory.forEach((s,idx)=>{
      const d = document.createElement('div');d.className='seed';d.title=s.colorName;d.style.background=`radial-gradient(circle at 30% 30%,rgba(255,255,255,.6),rgba(255,255,255,0)),linear-gradient(180deg,rgba(0,0,0,.06),rgba(0,0,0,.2)),rgb(${s.rgb.join(',')})`;
      d.onclick = ()=>{ log('تحديد بذرة: '+s.colorName); }
      inventoryEl.appendChild(d);
    });
  }

  // إنشاء بذور على الخريطة (بسيط: نقاط متفرقة)
  function placeSeeds(){
    const positions = [
      {x:180,y:120,name:'أحمر'},
      {x:980,y:160,name:'أزرق'},
      {x:540,y:640,name:'أصفر'}
    ];
    game.seeds = positions.map(p=>({x:p.x,y:p.y,colorName:p.name,rgb:COLORS[p.name],collected:false,radius:20}));
  }

  // بعض الأشياء القابلة للتلوين — مستطيلات أو أشجار
  function placeObjects(){
    game.objects = [
      {type:'شجرة',x:220,y:380,w:120,h:160,color:null,required:'أخضر',painted:false},
      {type:'جسر',x:520,y:220,w:320,h:60,color:null,required:'بني',painted:false},
      {type:'زهرة',x:920,y:520,w:80,h:80,color:null,required:'أرجواني',painted:false}
    ];
  }

  // تلميحات بسيطة: ما هي الألوان المطلوبة؟
  const COLOR_RECIPES = {
    'أخضر': ['أزرق','أصفر'],
    'برتقالي': ['أحمر','أصفر'],
    'أرجواني': ['أحمر','أزرق'],
    'بني': ['أحمر','أصفر','أزرق']
  };

  function guessRecipe(target){
    return COLOR_RECIPES[target] || [];
  }

  // تفاعل اللاعب: التقاط بذرة
  function tryCollectSeed(mx,my){
    for(const s of game.seeds){
      if(!s.collected){
        const d = Math.hypot(mx - s.x, my - s.y);
        if(d < s.radius+8){
          s.collected = true;
          game.inventory.push({colorName:s.colorName,rgb:s.rgb});
          renderInventory();renderPalette();log('جمعت بذرة: '+s.colorName);
          return true;
        }
      }
    }
    return false;
  }

  // محاولة التلوين: تفعل لو اللون الحالي يطابق وصفة المطلوبة
  function tryPaint(mx,my){
    if(!game.activeColor){ log('لا يوجد لون نشط — امزج أولاً.'); return; }
    for(const o of game.objects){
      if(!o.painted && mx>o.x && mx<o.x+o.w && my>o.y && my<o.y+o.h){
        // نحاول توافق اسم مع الوصفة (تقريب بسيط: نبحث عن أقرب وصفة حسب مكونات المزج)
        const recipe = guessRecipe(o.required);
        const mixNames = game.currentMix.map(c=>c.name);
        const success = recipe.every(r=>mixNames.includes(r)) && mixNames.length>=recipe.length;
        if(success){
          o.painted = true; o.color = game.activeColor; game.paintedAreas++;game.areasUnlocked = Math.min(4, game.areasUnlocked + 1);
          areasCountEl.textContent = game.areasUnlocked; log('نجحت في تلوين '+o.type+' باللون '+o.required+'!');
        } else {
          log('اللون غير مناسب — جرب مزج '+recipe.join(' + '));
        }
        return;
      }
    }
    log('لا يوجد شيء قابل للتلوين هنا.');
  }

  // مزج: تكون النتيجة RGB ومسمى تلقائي
  function doMix(){
    if(game.currentMix.length===0) { log('اختر ألواناً للمزج'); return; }
    const rgb = mixRGB(game.currentMix.map(c=>c.rgb));
    // اسم تلقائي مبسط: نبحث أي وصفة تتطابق مع أسماء الألوان المختارة
    const names = Array.from(new Set(game.currentMix.map(c=>c.name)));
    let matched = null;
    for(const [k,v] of Object.entries(COLOR_RECIPES)){
      const need = v.slice().sort().join('|');
      const have = names.slice().sort().join('|');
      if(need===have) { matched = k; break; }
    }
    const colorName = matched || `مزيج (${names.join('+')})`;
    game.activeColor = {colorName, rgb};
    currentColorEl.style.background = `rgb(${rgb.join(',')})`;
    log('حصلت على لون: '+colorName);
    // تفريغ المزج
    game.currentMix = [];
    renderPalette();
  }

  // رسم العالم — أبيض وأسود للمناطق غير الملونة
  function draw(){
    // خلفية أبيض وأسود
    ctx.clearRect(0,0,W,H);
    ctx.save();
    // أرضية بنقشة بسيطة
    ctx.fillStyle = '#f2f2f2';
    ctx.fillRect(0,0,W,H);

    // رسم عناصر الحديقة (بياض/أسود إذا لم تتلوّن، وإلا استخدم اللون)
    game.objects.forEach(o=>{
      ctx.save();
      if(o.painted){
        ctx.fillStyle = `rgb(${o.color.rgb.join(',')})`;
      } else {
        ctx.fillStyle = '#ffffff';
        ctx.strokeStyle = '#222';
        ctx.lineWidth = 2;
      }
      // شكل مبسط
      ctx.beginPath();
      ctx.roundRect ? ctx.roundRect(o.x,o.y,o.w,o.h,12) : ctx.fillRect(o.x,o.y,o.w,o.h);
      ctx.fill();
      if(!o.painted){ ctx.stroke(); ctx.fillStyle='#222'; ctx.font='14px sans-serif'; ctx.fillText(o.type,o.x+8,o.y+20);} else { ctx.fillStyle='rgba(0,0,0,.6)'; ctx.font='14px sans-serif'; ctx.fillText(o.type,o.x+8,o.y+20); }
      ctx.restore();
    });

    // بذور
    game.seeds.forEach(s=>{
      if(!s.collected){
        ctx.save();
        ctx.beginPath();ctx.arc(s.x,s.y,s.radius,0,Math.PI*2);
        // بذور مضيئة — استخدام تدرج
        const g = ctx.createRadialGradient(s.x-6,s.y-8,4,s.x,s.y,s.radius);
        g.addColorStop(0,'rgba('+s.rgb.join(',')+',1)');
        g.addColorStop(1,'rgba(255,255,255,0.05)');
        ctx.fillStyle = g;ctx.fill();
        ctx.strokeStyle='#111';ctx.lineWidth=2;ctx.stroke();
        ctx.fillStyle='#111';ctx.font='14px sans-serif';ctx.fillText(s.colorName,s.x-18,s.y+40);
        ctx.restore();
      }
    });

    // عناصر ديكور أحادية اللون (جسر قديم، أعشاب)
    ctx.save();ctx.fillStyle='#e9e9e9';ctx.fillRect(0,H-80,W,80);ctx.fillStyle='#d6d6d6';ctx.fillRect(60,H-160,160,80);ctx.restore();

    // لوحة تعليمات صغيرة
    ctx.save();ctx.fillStyle='rgba(0,0,0,.04)';ctx.fillRect(10,10,260,80);ctx.fillStyle='#222';ctx.font='13px sans-serif';ctx.fillText('انقر لالتقاط بذور. اسحب/اختر من اللوحة ثم اضغط امزج.',20,32);ctx.fillText('لتلوين: امزج لوناً ثم اضغط "استخدم اللون للتلوين" ثم انقر على العنصر.',20,52);ctx.restore();

    ctx.restore();
  }

  // تهيئة اللعبة
  function init(){
    placeSeeds();placeObjects();renderPalette();renderInventory();log('بدأت اللعبة — اجمع بذور الأحمر والأصفر والأزرق');
    draw();
  }

  // ---- أحداث المستخدم ----
  canvas.addEventListener('click', (e)=>{
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
    // أول حاول التقاط بذرة
    if(tryCollectSeed(mx,my)) { draw(); return; }
    // إن لم يكن هناك بذرة حاول التلوين إذا في وضع استعمال اللون
    if(paintMode){ tryPaint(mx,my); draw(); return; }
    log('نقر على الخريطة - ليس هناك تفاعل محدد');
  });

  // مفاتيح للـحركة/اختصارات
  window.addEventListener('keydown',(e)=>{
    if(e.key==='m') doMix();
    if(e.key==='p') paintMode = !paintMode; log('وضع التلوين: '+(paintMode? 'مفعل' : 'معطل'));
  });

  let paintMode = false;
  paintBtn.onclick = ()=>{ paintMode = !paintMode; log('وضع التلوين: '+(paintMode? 'مفعل' : 'معطل')); };
  mixBtn.onclick = ()=> doMix();
  inspectBtn.onclick = ()=>{
    log('تفقد الحديقة...');
    // تفقد بسيط: إظهار أشياء غير مرئية بعد تلوين معين
    if(game.paintedAreas>=1){ log('تلميح: أحد الجسور قد فتح ممرًا جديدًا شمالًا'); }
  };
  hintBtn.onclick = ()=>{
    // تلميح ذكي يعتمد على أقرب عنصر غير ملون
    const target = game.objects.find(o=>!o.painted);
    if(!target){ log('كل العناصر ملونة بالفعل — مبروك!'); return; }
    const recipe = guessRecipe(target.required);
    log('تلميح: لتلوين '+target.type+' تحتاج إلى: '+(recipe.length? recipe.join(' + ') : 'مزيج ملائم') );
  };

  // حلقة الرسوم
  function loop(){ draw(); requestAnimationFrame(loop); }

  // تهيئة ونشغيل
  init(); loop();

  // تحسين: إضافة roundRect لو لم تكن موجودة
  if(!CanvasRenderingContext2D.prototype.roundRect){ CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){ r=r||6; this.beginPath(); this.moveTo(x+r,y); this.arcTo(x+w,y,x+w,y+h,r); this.arcTo(x+w,y+h,x,y+h,r); this.arcTo(x,y+h,x,y,r); this.arcTo(x,y,x+w,y,r); this.closePath(); } }

  </script></body>
</html>